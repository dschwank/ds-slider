'use strict';
angular.module('ds.slider', []), angular.module('ds.slider').directive('dsSlider', ["$document", "$log", "dsSliderService", function (t, n, e) {
    return{restrict: "EA", replace: !0, require: "^ngModel", scope: {min: "@?", max: "@?", step: "@?", data: "=?ngModel"}, link: function (i, a) {
        function r(t, n) {
            return angular.element(t.querySelector(n))
        }

        function o() {
            return a[0].clientWidth - 36
        }

        function u(t, n) {
            e.updateCSSPosition(w.positioner, t, v.left, v.width, n)
        }

        function l(t, n) {
            i.data[t] = e.calculateVal(parseInt(i.min), v.multiplier, i.step, n), i.$apply()
        }

        function c(t, n) {
            var i = e.calculatePer(t, v.startVal, n, v.min, v.max);
            u(t, i), l(t, i)
        }

        function d(t) {
            return function (n) {
                c(t, (n.clientX - v.x) / v.totalWidth), n.preventDefault()
            }
        }

        function m(e) {
            var a = function (r) {
                r.preventDefault(), t.unbind("mousemove", e), t.unbind("mouseup", a), n.info("min: " + i.data.min + ", max: " + i.data.max)
            };
            return a
        }

        function s(t, n) {
            v.x = t.clientX, v.width = parseFloat(w.positioner.css("width")), v.width = v.width || 0 === v.width ? v.width : 100, v.left = parseFloat(w.positioner.css("left")) || 0, v.totalWidth = o(), v.startVal = n ? v.width + v.left : v.left, v.min = n ? v.left : 0, v.max = n ? 100 : v.width + v.left, v.multiplier = (i.max - i.min) / 100 / i.step, t.preventDefault()
        }

        function f(n) {
            return function (e) {
                s(e, "max" === n);
                var i = d(n);
                t.on("mousemove", i), t.on("mouseup", m(i))
            }
        }

        function p() {
            w = {min: r(a[0], ".minSlider"), positioner: r(a[0], ".positioner"), max: r(a[0], ".maxSlider")}
        }

        function x() {
            i.min = i.min || 0, i.max = i.max || 100, i.step = i.step || 1, i.data = i.data || {min: 0, max: i.max}
        }

        function h() {
            w.min.on("mousedown", f("min")), w.max.on("mousedown", f("max"))
        }

        var w = {}, v = {left: 0, width: 100};
        !function () {
            x(), p(), h()
        }()
    }, templateUrl: "src/templates/dsSlider.tpl.html"}
}]), angular.module('ds.slider').factory('dsSliderService', function () {
    function t(t, n, e, i, a) {
        var r = n + 100 * e;
        return r = 'max' === t ? i > r ? i : r > 100 ? 100 : r : 0 > r ? 0 : r > a ? a : r;
    }

    function n(t, n, e, i) {
        return parseInt(t) + Math.ceil(i * n) * e;
    }

    function e(t, n, e, i, a) {
        t.css('max' === n ? { width: a - e + '%' } : {
            width: i + e - a + '%',
            left: a + '%'
        });
    }

    return {
        calculatePer: function (n, e, i, a, r) {
            return t(n, e, i, a, r);
        },
        calculateVal: function (t, e, i, a) {
            return n(t, e, i, a);
        },
        updateCSSPosition: function (t, n, i, a, r) {
            e(t, n, i, a, r);
        }
    };
});