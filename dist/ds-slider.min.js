'use strict';
angular.module('ds.slider', []), angular.module('ds.slider').directive('dsSlider', ["$document", "$log", "dsSliderService", function (t, e, n) {
    return{restrict: "EA", replace: !0, require: "^ngModel", scope: {min: "@", max: "@", step: "@?", data: "=?ngModel"}, link: function (e, i, a) {
        function r(t, e) {
            return angular.element(t.querySelector(e))
        }

        function o() {
            return i[0].clientWidth - 36
        }

        function l(t, i) {
            e.data[t + "Per"] = n.calculatePer(t, S.startVal, i, S.min, S.max), e.data[t] = n.calculateVal(parseFloat(e.min), S.multiplier, e.step, e.data[t + "Per"]), g ? (e.$broadcast("dsSliderChange", e.data), e.$digest()) : e.$apply(), p(t)
        }

        function u(t) {
            return function (e) {
                x || (x = setTimeout(function () {
                    l(t, (e.clientX - S.x) / S.totalWidth), x = void 0
                }, v)), e.preventDefault()
            }
        }

        function d(e) {
            var n = function (i) {
                i.preventDefault(), t.unbind("mousemove", e), t.unbind("mouseup", n)
            };
            return n
        }

        function c(t, n) {
            S.x = t.clientX, S.width = parseFloat(w.positioner.css("width")), S.width = S.width || 0 === S.width ? S.width : 100, S.left = parseFloat(w.positioner.css("left")) || 0, S.totalWidth = o(), S.startVal = n ? S.width + S.left : S.left, S.min = n ? S.left : 0, S.max = n ? 100 : S.width + S.left, S.multiplier = (e.max - e.min) / 100 / e.step, t.preventDefault()
        }

        function m(e) {
            return function (n) {
                c(n, "max" === e);
                var i = u(e);
                t.on("mousemove", i), t.on("mouseup", d(i))
            }
        }

        function s() {
            w = {min: r(i[0], ".minSlider"), positioner: r(i[0], ".positioner"), max: r(i[0], ".maxSlider")}
        }

        function f() {
            e.step = e.step || 1, e.data = e.data || {min: e.min, max: e.max}, e.data.minPer = 100 / (e.max - e.min) * (e.data.min - e.min), e.data.maxPer = 100 / e.max * e.data.max, e.showShortInfo = a.enableShortInfo
        }

        function p(t) {
            t ? ("min" !== t || S.left || (S.left = e.data[t + "Per"]), n.updateCSSPosition(w.positioner, t, S.left, S.width, e.data[t + "Per"])) : (p("min"), p("max"))
        }

        function h() {
            w.min.on("mousedown", m("min")), w.max.on("mousedown", m("max")), p()
        }

        {
            var x, w = {}, S = {left: 0, width: 100}, v = a.updateThrottle || 20, g = a.enableBroadcast;
            a.enableApply
        }
        !function () {
            f(), s(), h()
        }()
    }, templateUrl: "src/templates/dsSlider.tpl.html"}
}]), angular.module('ds.slider').factory('dsSliderService', function () {
    function t(t, e, n, i, a) {
        var r = e + 100 * n;
        return r = 'max' === t ? i > r ? i : r > 100 ? 100 : r : 0 > r ? 0 : r > a ? a : r;
    }

    function e(t, e, n, i) {
        return parseInt(t) + Math.ceil(i * e) * n;
    }

    function n(t, e, n, i, a) {
        t.css('max' === e ? { width: a - n + '%' } : {
            width: i + n - a + '%',
            left: a + '%'
        });
    }

    function i() {
        var t = this instanceof i ? this : Object.create(i.prototype);
        return t.startX = 0, t.width = 0, t.left = 0, t.totalWidth = 0, t.startVal = 0, t.min = 0, t.max = 0, t.multiplier = 0, t;
    }

    return i.prototype.getMultiplier = function (t) {
        return (t.max - t.min) / 100 / t.step;
    }, {
        calculatePer: function (e, n, i, a, r) {
            return t(e, n, i, a, r);
        },
        calculateVal: function (t, n, i, a) {
            return e(t, n, i, a);
        },
        updateCSSPosition: function (t, e, i, a, r) {
            n(t, e, i, a, r);
        },
        initSliderObj: function () {
            return new i();
        }
    };
});